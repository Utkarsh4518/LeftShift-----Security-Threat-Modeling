# Security Threat Modeling Report

### 1. EXECUTIVE SUMMARY

**Project Name:** 2-Tier Scalable Web Application Architecture in 1 Zone

**Description:**
This diagram illustrates a 2-tier web application architecture deployed within a single AWS Availability Zone. It includes an Elastic Load Balancer that distributes incoming traffic to an Auto Scaling group of EC2 instances. The EC2 instances are attached to both a Root Volume and a Data Volume (EBS), with the Data Volume being backed up by an EBS Snapshot. Application logs are sent to an Amazon S3 Bucket. Static media content is served to users via Amazon CloudFront, which fetches the content from the same S3 Bucket. DNS resolution for the application and media domains is handled by Amazon Route 53.

**Risk Assessment:**
The architecture presents a **Critical** risk profile. The presence of a Critical severity threat involving IAM credential theft (SSRF), combined with High severity threats regarding data exposure and privilege escalation, requires immediate attention. Additionally, the Single Availability Zone design represents a fundamental architectural weakness affecting availability.

**Summary Statistics:**
- **Total Threats:** 8
- **Total Weaknesses:** 5
- **Total CVEs:** 0

**Top 3 Priority Actions:**
1. **Enforce IMDSv2:** Immediately update Launch Templates to require IMDSv2 and set hop limits to mitigate Critical SSRF risks (T-001).
2. **Encrypt Storage & Secure Snapshots:** Enforce EBS encryption by default and audit snapshot permissions to prevent public data exposure (T-004).
3. **Re-architect for High Availability:** Redesign the deployment to span multiple Availability Zones to eliminate the Single Point of Failure (W-001).

---

### 2. ARCHITECTURE EXTRACTION

#### Components List
| Component Name | Type |
| :--- | :--- |
| www.example.com | External User/Client |
| media.example.com | External User/Client |
| Amazon Route 53 | DNS Service |
| Elastic Load Balancing | Load Balancer |
| Auto Scaling group | Compute Management Service |
| EC2 Instance | Virtual Machine / Web Server |
| Root Volume | Block Storage (EBS) |
| Data Volume | Block Storage (EBS) |
| Amazon EBS Snapshot | Backup Storage |
| Amazon S3 Bucket | Object Storage |
| CloudFront | Content Delivery Network (CDN) |

#### Data Flows
| Source | Destination | Protocol |
| :--- | :--- | :--- |
| www.example.com | Amazon Route 53 | DNS Query |
| www.example.com | Elastic Load Balancing | HTTP/HTTPS |
| Elastic Load Balancing | EC2 Instance | HTTP/HTTPS |
| EC2 Instance | Root Volume | Storage I/O |
| EC2 Instance | Data Volume | Storage I/O |
| Data Volume | Amazon EBS Snapshot | AWS Internal (Snapshot) |
| EC2 Instance | Amazon S3 Bucket | HTTPS (PutObject - Logs) |
| media.example.com | CloudFront | HTTP/HTTPS |
| CloudFront | Amazon S3 Bucket | HTTPS (GetObject - Origin Fetch) |

#### Trust Boundaries
- Internet Boundary (External Users vs. AWS Services)
- Availability Zone #1 Boundary (Logical/Physical Isolation)
- Auto Scaling group Boundary (Compute Resources)

---

### 3. COMPONENT INVENTORY TABLE

| Component | Type | Inferred Technology | Criticality | Notes |
| :--- | :--- | :--- | :--- | :--- |
| Elastic Load Balancing | Load Balancer | Generic | High | Entry point/Gateway |
| Amazon Route 53 | DNS Service | CloudFront | High | Critical Infrastructure |
| EC2 Instance | Virtual Machine / Web Server | Generic | Medium | Application Logic |
| Amazon S3 Bucket | Object Storage | Generic | Medium | Stores Logs/Media |
| Auto Scaling group | Compute Management Service | Generic | Medium | Infrastructure Management |
| Root Volume | Block Storage (EBS) | Generic | Medium | OS Storage |
| Data Volume | Block Storage (EBS) | Generic | Medium | Data Storage |
| Amazon EBS Snapshot | Backup Storage | Generic | High | Contains Backup Data |
| CloudFront | Content Delivery Network (CDN) | Generic | Low | Static Content Delivery |
| www.example.com | External User/Client | EC2 Instance | N/A | External Entity |
| media.example.com | External User/Client | Amazon S3 Bucket | N/A | External Entity |

---

### 4. STRIDE THREAT ENUMERATION

| Threat ID | STRIDE Category | CWE ID | Affected Component | Description | Severity | Mitigation Steps |
| :--- | :--- | :--- | :--- | :--- | :--- | :--- |
| T-001 | Spoofing | CWE-918 | EC2 Instance | Server-Side Request Forgery (SSRF) via EC2 Instance Metadata Service (IMDSv1) Exploitation. Allows retrieval of temporary IAM credentials. | Critical | Enforce IMDSv2; Set HttpTokens=required; Strict egress filtering; Principle of Least Privilege. |
| T-002 | Tampering | CWE-444 | Elastic Load Balancing | HTTP Request Smuggling (CL.TE or TE.CL) via Elastic Load Balancer. Discrepancies in header parsing allow smuggling malicious requests. | High | Sync backend/frontend parsing; Use HTTP/2; Deploy AWS WAF with smuggling rules. |
| T-003 | Repudiation | CWE-732 | Amazon S3 Bucket | Tampering or Deletion of Application Logs in S3 Bucket. Compromised roles with delete permissions can remove evidence. | Medium | Enable S3 Object Lock (Compliance mode); Enable Versioning/MFA Delete; Restrict IAM policies (no DeleteObject). |
| T-004 | Information Disclosure | CWE-312 | Amazon EBS Snapshot | Exposure of Sensitive Data via Unencrypted EBS Snapshots. Unencrypted snapshots with public permissions expose data. | High | Enforce EBS Encryption by Default; Use Customer Managed KMS Keys; Block public access to snapshots. |
| T-005 | Denial of Service | CWE-407 | Auto Scaling group | Algorithmic Complexity / Resource Exhaustion Attack. Expensive requests trigger max scale-out, exhausting budget. | High | Implement Rate Limiting; Set MaxSize limits; App-level timeouts; AWS Budgets alerts. |
| T-006 | Elevation of Privilege | CWE-1035 | EC2 Instance | Local Privilege Escalation via Kernel Vulnerability on EC2. Outdated AMIs allow attackers with shell access to gain root. | High | Automated AMI pipeline (Image Builder); SSM Patch Manager; Runtime security monitoring (GuardDuty). |
| T-007 | Tampering | CWE-436 | CloudFront | Web Cache Poisoning via CloudFront. Manipulation of unkeyed inputs reflected in responses. | Medium | Include significant headers in Cache Key; Sanitize input headers; Use CloudFront Functions to normalize. |
| T-008 | Spoofing | CWE-672 | Amazon Route 53 | Subdomain Takeover via Route 53 Dangling Records. CNAME points to deleted resource, allowing hijacking. | Medium | Audit dangling CNAMEs; Use Alias records; Sync resource deletion with DNS removal via IaC. |

---

### 5. ARCHITECTURAL WEAKNESSES

| Weakness ID | Title | Description | Impact | Recommended Mitigation |
| :--- | :--- | :--- | :--- | :--- |
| W-001 | Single Availability Zone Deployment | The architecture explicitly states deployment within a 'Single AWS Availability Zone'. | Total loss of availability during AZ outages; inability to meet high-availability SLAs. | Re-architect to deploy EC2 instances and ELB across at least two Availability Zones (Multi-AZ). |
| W-002 | Missing Web Application Firewall (WAF) | No indication of AWS WAF attached to ELB or CloudFront. | Increased vulnerability to SQL Injection, XSS, automated bots, and zero-day exploits. | Attach AWS WAF to CloudFront and ALB with Managed Rulesets. |
| W-003 | Potential Lack of Encryption in Transit (Internal) | Flow 'Elastic Load Balancing -> EC2 Instance' often defaults to HTTP (port 80). | Attacker in VPC can sniff sensitive data (session tokens, PII) from the wire. | Implement End-to-End Encryption (TLS to EC2) or use Nitro Enclaves. |
| W-004 | Co-mingling of Logs and Static Content | Single S3 Bucket used for both 'Logs' and 'Static Media'. | Risk of accidental public exposure of logs or breakage of media delivery. | Use separate S3 buckets for Application Logs (private) and Static Media (public-read). |
| W-005 | Implicit Trust in Management Access | Architecture does not define a secure management plane; potential open SSH/RDP. | Brute force attacks against SSH/RDP leading to server compromise. | Remove SSH/RDP ingress rules; Use AWS Systems Manager (SSM) Session Manager. |

---

### 6. CVE DISCOVERY RESULTS

No CVE data provided in the analysis.

---

### 7. THREAT â†” CVE CORRELATION MATRIX

| Threat ID | Related CVE | Relationship Type | Notes |
| :--- | :--- | :--- | :--- |
| T-001 | CVE-2019-1003000 | Related | SSRF vulnerability example |
| T-002 | CVE-2020-11022 | Related | Request Smuggling example |
| T-005 | CVE-2021-23343 | Related | ReDoS example |
| T-006 | CVE-2022-0847 | Related | Dirty Pipe exploit example |

---

### 8. ATTACK PATH SIMULATIONS

#### AP-01: Lateral Movement to Data Exfiltration
**Description:** Multi-stage attack progressing from initial access to data theft
**Impact:** Complete compromise of sensitive data
**Likelihood:** Medium

**Attack Sequence:**
1. **Gain initial foothold via Server-Side Request Forgery (SSRF) via EC2 Instanc**
   - *Target:* EC2 Instance
   - *Technique:* T1078 - Valid Accounts / T1190 - Exploit Public-Facing Application
2. **Escalate privileges via Local Privilege Escalation via Kernel Vulnerabilit**
   - *Target:* EC2 Instance
   - *Technique:* T1068 - Exploitation for Privilege Escalation
3. **Exfiltrate data via Exposure of Sensitive Data via Unencrypted EBS Sna**
   - *Target:* Amazon EBS Snapshot
   - *Technique:* T1041 - Exfiltration Over C2 Channel

**Referenced Threats:** T-001, T-006, T-004

---

### 9. COMPONENT SECURITY PROFILES

**EC2 Instance**
- **Threat Count:** 2 (T-001, T-006)
- **Risk Level:** **Critical**
- **Key Vulnerabilities:** SSRF via IMDSv1, Kernel Privilege Escalation.
- **Priority Mitigation:** Enforce IMDSv2 and implement automated patching.

**Elastic Load Balancing**
- **Threat Count:** 1 (T-002)
- **Risk Level:** **High**
- **Key Vulnerabilities:** HTTP Request Smuggling.
- **Priority Mitigation:** Synchronize HTTP parsing and deploy WAF.

**Amazon EBS Snapshot**
- **Threat Count:** 1 (T-004)
- **Risk Level:** **High**
- **Key Vulnerabilities:** Unencrypted snapshots / Public permissions.
- **Priority Mitigation:** Enforce encryption and block public access.

**Auto Scaling group**
- **Threat Count:** 1 (T-005)
- **Risk Level:** **High**
- **Key Vulnerabilities:** Resource Exhaustion (DoS).
- **Priority Mitigation:** Rate limiting and budget alerts.

**Amazon S3 Bucket**
- **Threat Count:** 1 (T-003)
- **Risk Level:** Medium
- **Key Vulnerabilities:** Log tampering/deletion.
- **Priority Mitigation:** Enable Object Lock and Versioning.

**CloudFront**
- **Threat Count:** 1 (T-007)
- **Risk Level:** Medium
- **Key Vulnerabilities:** Web Cache Poisoning.
- **Priority Mitigation:** Strict cache key configuration.

**Amazon Route 53**
- **Threat Count:** 1 (T-008)
- **Risk Level:** Medium
- **Key Vulnerabilities:** Subdomain Takeover.
- **Priority Mitigation:** Audit dangling records.

---

### 10. NIST 800-53 CONTROL MAPPING

| Risk Area | Threat ID(s) | Recommended NIST Control | Control Family | Rationale |
| :--- | :--- | :--- | :--- | :--- |
| Instance Metadata Access | T-001 | AC-6 (Least Privilege) | Access Control | Restricting access to IMDS credentials enforces least privilege. |
| Input Validation | T-002, T-007 | SI-10 (Information Input Validation) | System and Information Integrity | Prevents smuggling and cache poisoning by validating headers. |
| Audit Integrity | T-003 | AU-9 (Protection of Audit Information) | Audit and Accountability | Protects logs from unauthorized deletion or modification (Object Lock). |
| Data at Rest Protection | T-004 | SC-28 (Protection of Information at Rest) | System and Communications Protection | Ensures EBS snapshots are encrypted to prevent disclosure. |
| Availability | T-005 | SC-5 (Denial of Service Protection) | System and Communications Protection | Mitigates resource exhaustion attacks via rate limiting. |
| System Patching | T-006 | SI-2 (Flaw Remediation) | System and Information Integrity | Ensures kernel vulnerabilities are patched to prevent escalation. |
| Configuration Management | T-008 | CM-7 (Least Functionality) | Configuration Management | Removes dangling DNS records to prevent unauthorized use. |

---

### 11. HARDENING PLAN

**Quick Wins (< 1 day)**
- **T-001:** Update Launch Templates to enforce `HttpTokens=required` (IMDSv2) and `HttpPutResponseHopLimit=1`.
- **T-004:** Enable "Block Public Access for EBS Snapshots" in account settings.
- **W-005:** Remove all SSH (22) and RDP (3389) ingress rules from Security Groups.

**Short-Term (1-4 weeks)**
- **T-003:** Enable S3 Versioning and Object Lock (Compliance Mode) on the log bucket.
- **W-002:** Deploy AWS WAF on the ELB and CloudFront with Core Rule Sets.
- **T-006:** Implement AWS Systems Manager Patch Manager to automate OS patching.
- **T-004:** Re-encrypt existing unencrypted snapshots using a Customer Managed KMS Key.

**Long-Term (1-3 months)**
- **W-001:** Re-architect the application to use a Multi-AZ Auto Scaling Group and Load Balancer configuration.
- **W-004:** Migrate static media to a dedicated S3 bucket, separating it from logs.
- **W-003:** Configure TLS termination on EC2 instances for end-to-end encryption.

---

### 12. APPENDIX

- **Report Generation Timestamp:** 2026-01-31T19:42:21.479314
- **Data Sources:** System Architecture Diagram, Threat Analysis Data (JSON).
- **Methodology:** STRIDE Threat Modeling, NIST 800-53 Control Mapping.